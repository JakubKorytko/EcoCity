<content>
  <main>
    <section>
      <img src="/public/images/reports/placeholder.png" alt="Report Icon" />
      <div>
        <h3>Report title</h3>
        <p>Somewhere</p>
        <div>
          <span>Time difference</span>
          <span></span>
        </div>
      </div>
    </section>
    <section>
      <div>Status</div>
      <div>
        <NavLink to="/reports"
          ><img src="/public/images/other_icons/eye.svg" alt="View"
        /></NavLink>
        <img
          src="/public/images/other_icons/edit.svg"
          alt="Edit Icon"
          id="edit"
        />
      </div>
    </section>
  </main>
</content>

<script>
  import getDistanceToLocation from "/modules/location.pig";
  import { notImplemented } from "/modules/helpers.pig";

  const { data } = $attrs;

  $element("NavLink").setAttribute("to", `/report?id=${data.id}`);

  $element("img#edit").on("click", () => notImplemented("Edit report"));

  getDistanceToLocation(data.geoLocation?.latitude, data.geoLocation?.longitude)
    .then(({ distanceKm }) => {
      $element(
        "main > section:first-of-type > div span:last-of-type",
      ).textContent = `${distanceKm.toFixed(2)} km away` || "";
    })
    .catch(console.warn);

  $element("main > section:first-of-type > img").src =
    data.image || "/public/images/reports/placeholder.png";
  $element("main > section:first-of-type h3").textContent =
    data.title || "Report title";
  $element("main > section:first-of-type p").textContent =
    data.geoLocation?.city || "Somewhere";

  $element(
    "main > section:first-of-type > div span:first-of-type",
  ).textContent = data.timeDifference || "Time difference";
  $element("main > section:nth-of-type(2) > div").textContent =
    data.status || "Status";
  $element("main > section:nth-of-type(2) > div").className =
    `badge badge-${data.status?.toLowerCase() || "badge"}`;
</script>

<style>
  @import "/public/styles/globals.css";

  #edit {
    cursor: pointer;
  }

  :host {
    width: 100%;

    main {
      border-radius: 8px;
      background: #fff;
      box-shadow:
        0 1px 2px 0 rgba(0, 0, 0, 0.05),
        0 0 0 0 rgba(0, 0, 0, 0),
        0 0 0 0 rgba(0, 0, 0, 0);
      padding: 24px;
      width: 100%;
      display: flex;
      flex-direction: row;
      justify-content: space-between;

      section {
        &:first-of-type {
          display: flex;
          flex-direction: row;
          align-items: center;

          img {
            width: 48px;
            height: 48px;
          }
        }

        &:nth-of-type(2) {
          display: flex;
          flex-direction: column;
          gap: 8px;

          img {
            width: 16px;
            height: 16px;
          }

          div:last-of-type {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;
            gap: 4px;
          }
        }
      }
    }
  }
</style>
